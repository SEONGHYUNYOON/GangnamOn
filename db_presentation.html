<!DOCTYPE html>
<html lang="ko">

<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>GangnamOn DB Architecture</title>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/theme/dracula.min.css">
     <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
     <style>
          .reveal h1,
          .reveal h2,
          .reveal h3 {
               font-family: 'Pretendard', sans-serif;
          }

          .reveal p,
          .reveal li {
               font-size: 0.8em;
               line-height: 1.6;
          }

          .text-left {
               text-align: left;
          }

          .highlight {
               color: #f1c40f;
               font-weight: bold;
          }

          .db-table {
               font-size: 0.6em;
               width: 100%;
               border-collapse: collapse;
               margin-top: 20px;
          }

          .db-table th,
          .db-table td {
               border: 1px solid #555;
               padding: 10px;
          }

          .db-table th {
               background: #444;
               color: #fff;
          }
     </style>
</head>

<body>
     <div class="reveal">
          <div class="slides">

               <!-- Slide 1: Title -->
               <section>
                    <h1>GangnamOn DB Architecture</h1>
                    <h3>ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¶• í˜„í™© ë° êµ¬ì¡° ë¦¬ë·°</h3>
                    <p>2026. 01. 16 | Frontend/DB Team</p>
               </section>

               <!-- Slide 2: Overview -->
               <section>
                    <h2>ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš” (Overview)</h2>
                    <div class="text-left">
                         <p><strong>Platform:</strong> Supabase (PostgreSQL ê¸°ë°˜ BaaS)</p>
                         <p><strong>Auth:</strong> Supabase Auth (ì´ë©”ì¼/íŒ¨ìŠ¤ì›Œë“œ)</p>
                         <p><strong>Connection:</strong> <code>supabase-js</code> Direct Connect</p>
                         <hr>
                         <ul>
                              <li><span class="highlight">Serverless:</span> ë³„ë„ ë°±ì—”ë“œ ì—†ì´ í”„ë¡ íŠ¸ì—ì„œ ì§ì ‘ ì œì–´</li>
                              <li><span class="highlight">RLS (Row Level Security):</span> DB ë ˆë²¨ì˜ ê°•ë ¥í•œ ë³´ì•ˆ ì •ì±…</li>
                         </ul>
                    </div>
               </section>

               <!-- Slide 3: ERD -->
               <section>
                    <h2>ğŸ—ºï¸ ERD êµ¬ì¡° (Entity Relationship)</h2>
                    <p>"User ì¤‘ì‹¬ì˜ ìŠ¤íƒ€ ìŠ¤í‚¤ë§ˆ êµ¬ì¡°"</p>
                    <div class="text-left"
                         style="font-size: 0.8em; background: #222; padding: 20px; border-radius: 10px;">
                         <p>ğŸ”¹ <strong>Profiles (Core):</strong> ì‚¬ìš©ì ìƒì„¸ ì •ë³´ & ì˜¨(í™”í)</p>
                         <p>ğŸ”¹ <strong>Posts (Content):</strong> ì¤‘ê³ ë§ˆì¼“, ì†Œëª¨ì„ í†µí•© ê´€ë¦¬</p>
                         <p>ğŸ”¹ <strong>Chat System:</strong> Rooms - Participants - Messages</p>
                         <p>ğŸ”¹ <strong>Schools:</strong> Schools - Alumni (ë™ì°½ìƒ)</p>
                    </div>
               </section>

               <!-- Slide 4: Profiles Table -->
               <section>
                    <h2>ğŸ‘¤ í•µì‹¬ í…Œì´ë¸”: Profiles</h2>
                    <p>ì‚¬ìš©ì ìì‚°(ì˜¨) ë° í”„ë¡œí•„ ê´€ë¦¬</p>
                    <table class="db-table">
                         <thead>
                              <tr>
                                   <th>Column</th>
                                   <th>Type</th>
                                   <th>Description</th>
                              </tr>
                         </thead>
                         <tbody>
                              <tr>
                                   <td>id (PK)</td>
                                   <td>UUID</td>
                                   <td>auth.users IDì™€ ë§¤í•‘ (FK)</td>
                              </tr>
                              <tr>
                                   <td>username</td>
                                   <td>Text</td>
                                   <td>ì‚¬ìš©ì ë‹‰ë„¤ì„ (Unique)</td>
                              </tr>
                              <tr>
                                   <td class="highlight">beans</td>
                                   <td class="highlight">Integer</td>
                                   <td class="highlight">í•µì‹¬ ì¬í™” (Default: 1250)</td>
                              </tr>
                              <tr>
                                   <td>gallery_urls</td>
                                   <td>Text[]</td>
                                   <td>ë¯¸ë‹ˆí™ˆí”¼ ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€</td>
                              </tr>
                         </tbody>
                    </table>
               </section>

               <!-- Slide 5: Posts Table -->
               <section>
                    <h2>ğŸ“ í•µì‹¬ í…Œì´ë¸”: Posts (í†µí•© í”¼ë“œ)</h2>
                    <p>'Type' ì»¬ëŸ¼ì„ ì´ìš©í•œ ë‹¤í˜•ì„±(Polymorphic) ì„¤ê³„</p>
                    <table class="db-table">
                         <thead>
                              <tr>
                                   <th>Column</th>
                                   <th>Desc</th>
                              </tr>
                         </thead>
                         <tbody>
                              <tr>
                                   <td class="highlight">type</td>
                                   <td class="highlight">'market' | 'gathering' | 'club'</td>
                              </tr>
                              <tr>
                                   <td>price</td>
                                   <td>ì¤‘ê³  ê±°ë˜ ê°€ê²© (Market ì „ìš©)</td>
                              </tr>
                              <tr>
                                   <td>participants</td>
                                   <td>í˜„ì¬ ì°¸ì—¬ ì¸ì› (Gathering ì „ìš©)</td>
                              </tr>
                              <tr>
                                   <td>location</td>
                                   <td>ê±°ë˜/ëª¨ì„ ì¥ì†Œ</td>
                              </tr>
                         </tbody>
                    </table>
               </section>

               <!-- Slide 6: Chat System -->
               <section>
                    <h2>ğŸ’¬ ì±„íŒ… ì‹œìŠ¤í…œ êµ¬ì¡°</h2>
                    <div class="text-left">
                         <h3>1. 1:1 Chat</h3>
                         <ul>
                              <li><strong>Rooms:</strong> ì±„íŒ…ë°© ID ìƒì„±</li>
                              <li><strong>Participants:</strong> (Room_ID, User_ID) ë§¤í•‘</li>
                              <li><strong>Messages:</strong> ëŒ€í™” ë‚´ìš© ë° ì½ìŒ(is_read) ìƒíƒœ</li>
                         </ul>
                         <br>
                         <h3>2. Guestbook (ë°©ëª…ë¡)</h3>
                         <ul>
                              <li>Host(ì£¼ì¸) - Author(ê¸€ì“´ì´) êµ¬ì¡°</li>
                              <li><code>is_secret</code> ì»¬ëŸ¼ìœ¼ë¡œ ë¹„ë°€ê¸€ ê¸°ëŠ¥ ì§€ì›</li>
                         </ul>
                    </div>
               </section>

               <!-- Slide 7: Data Sync Logic -->
               <section>
                    <h2>ğŸ”„ ë°ì´í„° ë™ê¸°í™” ë¡œì§ (App.jsx)</h2>
                    <div class="text-left">
                         <p><strong>1. í™”í(Beans) ë™ê¸°í™”</strong></p>
                         <pre><code class="javascript" data-trim>
const updateBeanCount = async (delta) => {
    // 1. í™”ë©´ ì¦‰ì‹œ ë°˜ì˜ (Optimistic UI)
    setBeanCount(prev => prev + delta);
    
    // 2. DB ë¹„ë™ê¸° ì €ì¥
    supabase.from('profiles').update({ beans: newValue })...
};
                    </code></pre>
                         <p><strong>2. ì•„ë°”íƒ€ êµ¬ë§¤ ë‚´ì—­</strong></p>
                         <ul>
                              <li>DB Tableì´ ì•„ë‹Œ <code>auth.user_metadata</code>ì— JSON ì €ì¥</li>
                              <li>ë¡œê·¸ì¸ ì„¸ì…˜(Session)ì— í¬í•¨ë˜ì–´ ë¹ ë¥¸ ì ‘ê·¼ ê°€ëŠ¥</li>
                         </ul>
                    </div>
               </section>

               <!-- Slide 8: Security (RLS) -->
               <section>
                    <h2>ğŸ›¡ï¸ ë³´ì•ˆ ì •ì±… (RLS)</h2>
                    <p>í´ë¼ì´ì–¸íŠ¸ ì§ì ‘ ì ‘ê·¼ì„ ìœ„í•œ í•„ìˆ˜ ë³´ì•ˆ ì„¤ì •</p>
                    <div class="text-left" style="background: #1e1e1e; padding: 15px; border-radius: 8px;">
                         <p>âœ… <strong>Public Read:</strong> í”„ë¡œí•„/ê²Œì‹œê¸€ì€ ëˆ„êµ¬ë‚˜ ì¡°íšŒ</p>
                         <p>ğŸ”’ <strong>Private Write:</strong></p>
                         <ul>
                              <li>ë‚´ í”„ë¡œí•„ì€ <strong>ë‚˜(auth.uid)</strong>ë§Œ ìˆ˜ì • ê°€ëŠ¥</li>
                              <li>ë‚´ ê¸€ì€ <strong>ì‘ì„±ì</strong>ë§Œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥</li>
                              <li>ì±„íŒ…ì€ <strong>ì°¸ì—¬ì</strong>ë§Œ ì¡°íšŒ ê°€ëŠ¥</li>
                         </ul>
                    </div>
               </section>

               <!-- Slide 9: Future Tasks -->
               <section>
                    <h2>ğŸš€ í–¥í›„ ê³¼ì œ (Refactoring)</h2>
                    <ul>
                         <li>[DB] <code>transaction_logs</code> í…Œì´ë¸” ì¶”ê°€ (ì‚¬ìš© ë‚´ì—­ ê¸°ë¡)</li>
                         <li>[Web] Supabase Realtime êµ¬ë… ì—°ê²° (ì‹¤ì‹œê°„ ì±„íŒ…)</li>
                         <li>[Storage] ì´ë¯¸ì§€ ë²„í‚· ì •ì±…(Bucket Policy) ì ê²€</li>
                    </ul>
               </section>

          </div>
     </div>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/plugin/highlight/highlight.min.js"></script>
     <script>
          Reveal.initialize({
               hash: true,
               plugins: [RevealHighlight]
          });
     </script>
</body>

</html>